---
import GlobalLayout from "../layouts/GlobalLayout.astro";
import App from "../components/App.tsx";
import type { Session } from "@supabase/supabase-js";

// Get session from server-side Supabase client
let initialSession: Session | null = null;
let user = Astro.locals.user;
if (Astro.locals.supabase) {
  try {
    const { data } = await Astro.locals.supabase.auth.getSession();
    initialSession = data.session;
    // eslint-disable-next-line no-console
    console.log("Settings page: got session from server", initialSession);
  } catch (error) {
    // eslint-disable-next-line no-console
    console.warn("Failed to get session for settings page:", error);
  }
} else {
  // eslint-disable-next-line no-console
  console.log("Settings page: no supabase client in locals");
}

// Pass environment variables to client components
const supabaseConfig = {
  url: import.meta.env.PUBLIC_SUPABASE_URL || import.meta.env.SUPABASE_URL,
  key: import.meta.env.PUBLIC_SUPABASE_KEY || import.meta.env.SUPABASE_KEY,
};
---

<GlobalLayout title="Settings - PulseReader">
  <div class="min-h-screen bg-background">
    <App
      client:only="react"
      page="settings"
      initialSession={initialSession}
      supabaseConfig={supabaseConfig}
      settingsUser={user}
    />
  </div>
</GlobalLayout>

---
import GlobalLayout from "../layouts/GlobalLayout.astro";
import App from "../components/App.tsx";
import SettingsForm from "../components/SettingsForm";
import type { Session } from "@supabase/supabase-js";

// Get session from server-side Supabase client
let initialSession: Session | null = null;
let user = Astro.locals.user;
if (Astro.locals.supabase) {
  try {
    const { data } = await Astro.locals.supabase.auth.getSession();
    initialSession = data.session;
    console.log("Settings page: got session from server", initialSession);
  } catch (error) {
    console.warn("Failed to get session for settings page:", error);
  }
} else {
  console.log("Settings page: no supabase client in locals");
}

// Pass environment variables to client components
const supabaseConfig = {
  url: import.meta.env.PUBLIC_SUPABASE_URL || import.meta.env.SUPABASE_URL,
  key: import.meta.env.PUBLIC_SUPABASE_KEY || import.meta.env.SUPABASE_KEY,
};
---

<GlobalLayout title="Settings - PulseReader">
  <div class="min-h-screen bg-background">
    <App client:only="react" initialSession={initialSession} supabaseConfig={supabaseConfig}>
      <main class="container mx-auto px-4 py-8 max-w-2xl">
        <div class="space-y-8">
          <div class="space-y-2">
            <h1 class="text-3xl font-bold">Settings</h1>
            <p class="text-muted-foreground">Customize your news feed preferences to get the most relevant content.</p>
          </div>

          <SettingsForm client:only="react" user={user} />
        </div>
      </main>
    </App>
  </div>
</GlobalLayout>

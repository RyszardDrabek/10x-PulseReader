---
import GlobalLayout from "../layouts/GlobalLayout.astro";
import App from "../components/App.tsx";
import Homepage from "../components/Homepage.tsx";
import { ArticleService } from "../lib/services/article.service";
import { supabaseClient } from "../db/supabase.client";

const supabase = supabaseClient;
const articleService = new ArticleService(supabase);

const initialArticles = await articleService.getArticles({ limit: 20, offset: 0 });

// Get initial session for client-side hydration
const {
  data: { session },
} = await supabase.auth.getSession();

// Pass environment variables to client components
const supabaseConfig = {
  url: import.meta.env.PUBLIC_SUPABASE_URL || import.meta.env.SUPABASE_URL,
  key: import.meta.env.PUBLIC_SUPABASE_KEY || import.meta.env.SUPABASE_KEY,
};
---

<GlobalLayout title="PulseReader - Your Personalized News Feed">
  <div style="min-height: 100vh;">
    <App client:only="react" initialSession={session} supabaseConfig={supabaseConfig}>
      <Homepage initialData={initialArticles} />
    </App>
  </div>
</GlobalLayout>
